import{a as P,C as T,p as Y,b as q,c as z,L as A,d as H,e as K,P as M,f as Q}from"./index-CcACpD41.js";import{d as Z,r as p,o as G,w as I,c as N,a as _,b as m,e as t,f as v,g as V,h as r,u as J,i as x,j as W,F as X,k as $,l as c,t as d}from"./index-CHzXR4X7.js";async function ee(C,n,o,s,g){return(await P.get("/api/orders",{params:{key:C,dateFrom:s,dateTo:g,page:n,limit:o}})).data}const B=20,ae=Z({__name:"Orders",setup(C){T.register(Y,q,z,A,H,K,M);const n=p([]),o=p(!1),s=p(1),g=p(1),f=p("2024-01-01"),h=p("2024-12-31"),E="E6kUTYrYwZq2tN4QEtyzsbEBk3ie",y=async()=>{var l;o.value=!0;try{const e=await ee(E,s.value,B,f.value,h.value);n.value=e.data,g.value=((l=e.meta)==null?void 0:l.last_page)??1}catch(e){console.error("Ошибка загрузки заказов:",e)}finally{o.value=!1}};G(y),I([s],y);const L=N(()=>{const l=n.value.reduce((i,k)=>{const b=k.date.split(" ")[0];return i[b]=(i[b]||0)+1,i},{}),e=Object.keys(l),u=Object.values(l);return{labels:e,datasets:[{label:"Количество заказов",data:u,borderColor:"rgba(138, 43, 226, 1)",backgroundColor:"rgba(138, 43, 226, 0.2)",tension:.4,fill:!0,pointRadius:5,pointHoverRadius:7}]}}),O=N(()=>{const l={};for(const e of n.value){const u=e.supplier_article;l[u]=(l[u]||0)+1}return l}),U={responsive:!0,plugins:{legend:{display:!0}}},D=l=>{const e=Number(l);return isNaN(e)?"—":e.toLocaleString("ru-RU",{style:"currency",currency:"RUB",minimumFractionDigits:0,maximumFractionDigits:0})};return(l,e)=>{const u=r("v-text-field"),i=r("v-col"),k=r("v-row"),b=r("v-progress-circular"),F=r("v-table"),R=r("v-alert"),S=r("v-pagination"),j=r("v-container");return c(),_(j,null,{default:m(()=>[e[5]||(e[5]=t("h2",null,"Заказы",-1)),v(k,null,{default:m(()=>[v(i,{cols:"12",md:"3"},{default:m(()=>[v(u,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),label:"Дата от",type:"date",onChange:y},null,8,["modelValue"])]),_:1}),v(i,{cols:"12",md:"3"},{default:m(()=>[v(u,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=a=>h.value=a),label:"Дата до",type:"date",onChange:y},null,8,["modelValue"])]),_:1})]),_:1}),o.value?(c(),_(b,{key:0,indeterminate:"",color:"primary"})):V("",!0),!o.value&&n.value.length?(c(),_(J(Q),{key:1,"chart-data":L.value,"chart-options":U,class:"mb-6"},null,8,["chart-data"])):V("",!0),!o.value&&n.value.length?(c(),_(F,{key:2},{default:m(()=>[e[3]||(e[3]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Номер"),t("th",null,"Дата"),t("th",null,"Артикул"),t("th",null,"Склад"),t("th",null,"Кол-во"),t("th",null,"Сумма")])],-1)),t("tbody",null,[(c(!0),x(X,null,W(n.value,(a,w)=>(c(),x("tr",{key:w},[t("td",null,d(w+1+(s.value-1)*B),1),t("td",null,d(a.g_number),1),t("td",null,d(a.date),1),t("td",null,d(a.supplier_article),1),t("td",null,d(a.warehouse_name),1),t("td",null,d(O.value[a.supplier_article]||1),1),t("td",null,d(D(a.total_price)),1)]))),128))])]),_:1,__:[3]})):o.value?V("",!0):(c(),_(R,{key:3,type:"info"},{default:m(()=>e[4]||(e[4]=[$("Нет данных за выбранный период")])),_:1,__:[4]})),v(S,{modelValue:s.value,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value=a),length:g.value,"total-visible":5,class:"mt-4"},null,8,["modelValue","length"])]),_:1,__:[5]})}}});export{ae as default};
