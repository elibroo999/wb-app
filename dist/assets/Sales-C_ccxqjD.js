import{a as j,C as O,p as T,b as A,c as R,L as Y,d as q,e as z,P as I,f as K}from"./index-CcACpD41.js";import{d as M,r as p,o as Q,w as Z,c as G,a as g,b as _,e as t,f as m,g as w,h as r,u as H,i as D,j as J,F as W,k as X,l as c,t as v}from"./index-CHzXR4X7.js";async function $(C,l,n,u,f){const d=await j.get("/api/sales",{params:{key:C,dateFrom:u,dateTo:f,page:l,limit:n}});return{data:d.data.data.map(o=>({sale_id:o.sale_id,date:o.date,supplier_article:o.supplier_article,warehouse_name:o.warehouse_name,total_price:Number(o.total_price),discount_percent:Number(o.discount_percent)})),meta:d.data.meta}}const S=20,ae=M({__name:"Sales",setup(C){O.register(T,A,R,Y,q,z,I);const l=p([]),n=p(!1),u=p(1),f=p(1),d=p("2024-01-01"),y=p("2024-12-31"),o="E6kUTYrYwZq2tN4QEtyzsbEBk3ie",b=async()=>{var s;n.value=!0;try{const e=await $(o,u.value,S,d.value,y.value);l.value=e.data,f.value=((s=e.meta)==null?void 0:s.last_page)??1,console.log("Sales from API:",l.value)}catch(e){console.error("Ошибка загрузки продаж:",e)}finally{n.value=!1}};Q(b),Z([u],b);const B=G(()=>{const s=l.value.reduce((i,k)=>{const N=k.date.split(" ")[0],V=Number(k.total_price);return i[N]=(i[N]||0)+(isNaN(V)?0:V),i},{}),e=Object.keys(s),h=Object.values(s);return{labels:e,datasets:[{label:"Сумма продаж",data:h,borderColor:"rgba(220, 20, 60, 1)",backgroundColor:"rgba(220, 20, 60, 0.2)",tension:.3,fill:!0}]}}),E={responsive:!0,plugins:{legend:{display:!0}}},L=s=>{const e=Number(s);return isNaN(e)?"—":e.toLocaleString("ru-RU",{style:"currency",currency:"RUB",minimumFractionDigits:0,maximumFractionDigits:0})};return(s,e)=>{const h=r("v-text-field"),i=r("v-col"),k=r("v-row"),N=r("v-progress-circular"),V=r("v-table"),U=r("v-alert"),F=r("v-pagination"),P=r("v-container");return c(),g(P,null,{default:_(()=>[e[5]||(e[5]=t("h2",null,"Продажи",-1)),m(k,null,{default:_(()=>[m(i,{cols:"12",md:"3"},{default:_(()=>[m(h,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),label:"Дата от",type:"date",onChange:b},null,8,["modelValue"])]),_:1}),m(i,{cols:"12",md:"3"},{default:_(()=>[m(h,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=a=>y.value=a),label:"Дата до",type:"date",onChange:b},null,8,["modelValue"])]),_:1})]),_:1}),n.value?(c(),g(N,{key:0,indeterminate:"",color:"primary"})):w("",!0),!n.value&&l.value.length?(c(),g(H(K),{key:1,"chart-data":B.value,"chart-options":E,class:"mb-6"},null,8,["chart-data"])):w("",!0),!n.value&&l.value.length?(c(),g(V,{key:2},{default:_(()=>[e[3]||(e[3]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Дата"),t("th",null,"Артикул"),t("th",null,"Склад"),t("th",null,"Сумма"),t("th",null,"Скидка %")])],-1)),t("tbody",null,[(c(!0),D(W,null,J(l.value,(a,x)=>(c(),D("tr",{key:x},[t("td",null,v(x+1+(u.value-1)*S),1),t("td",null,v(a.date.split(" ")[0]),1),t("td",null,v(a.supplier_article),1),t("td",null,v(a.warehouse_name),1),t("td",null,v(L(a.total_price)),1),t("td",null,v(a.discount_percent)+"%",1)]))),128))])]),_:1,__:[3]})):n.value?w("",!0):(c(),g(U,{key:3,type:"info"},{default:_(()=>e[4]||(e[4]=[X(" Нет данных за выбранный период ")])),_:1,__:[4]})),m(F,{modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=a=>u.value=a),length:f.value,"total-visible":5,class:"mt-4"},null,8,["modelValue","length"])]),_:1,__:[5]})}}});export{ae as default};
